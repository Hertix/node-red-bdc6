// nodes/BDC6_Errors_Warnings_BDC6_Error_xx_ILS.js
module.exports = function(RED){const {toRaw,packBits}=require("../lib/bits.js");function N(c){RED.nodes.createNode(this,c);const n=this;const mn=c.message_name,sn=c.signal_name;const idh=c.can_id_hex||"0x000";const sb=parseInt(c.start_bit),bl=parseInt(c.bit_length);const f=Number(c.factor||1),o=Number(c.offset||0);const u=c.unit||"";const bo=(c.byte_order||"intel").toLowerCase();const s=!!c.signed;const pmin=(c.min!==""&&c.min!==undefined)?Number(c.min):null;const pmax=(c.max!==""&&c.max!==undefined)?Number(c.max):null;const d=(c.default!==""&&c.default!==undefined)?Number(c.default):null;function send(v,ov){try{const raw=toRaw(v,f,o,s,pmin,pmax);const {mask,valueBits}=packBits(raw,sb,bl,bo,s);const out={type:"BDC6_SIGNAL_UPDATE",message:mn,signal:sn,can_id:Number(idh),mask_hex:"0x"+mask.toString(16),value_bits_hex:"0x"+valueBits.toString(16),interval_ms:ov?.interval_ms,cyclic:ov?.cyclic,immediate:ov?.immediate,meta:{unit:u,factor:f,offset:o,signed:s,start_bit:sb,bit_length:bl,byte_order:bo}};n.send({topic:`${mn}:${sn}`,payload:out});}catch(e){n.error(e);}}n.on("input",(msg)=>{let v,ov={};if(typeof msg.payload==="number"){v=msg.payload;}else if(msg&&typeof msg.payload==="object"){if(msg.payload.value===undefined){n.error("payload must be number or { value }");return;}v=Number(msg.payload.value);ov={immediate:msg.payload.immediate,cyclic:msg.payload.cyclic,interval_ms:msg.payload.interval_ms};}else{n.error("Unsupported payload");return;}send(v,ov);});if(d!==null)setTimeout(()=>send(d,{}),50);}RED.nodes.registerType("BDC6_Errors_Warnings_BDC6_Error_xx_ILS",N,{category:"BDC6*",defaults:{name:{value:"BDC6_Errors_Warnings:BDC6_Error_xx_ILS"},message_name:{value:"BDC6_Errors_Warnings"},signal_name:{value:"BDC6_Error_xx_ILS"},can_id_hex:{value:"0x320"},start_bit:{value:14},bit_length:{value:1},factor:{value:"1"},offset:{value:"0"},unit:{value:""},byte_order:{value:"intel"},signed:{value:0},min:{value:"0"},max:{value:"1"},"default":{value:"0"},category:{value:"BDC6*"}},inputs:1,outputs:1,icon:"font-awesome/fa-sliders",color:"#ddeeff",paletteLabel:"BDC6_Error_xx_ILS",label:function(){return this.name||"BDC6_Errors_Warnings:BDC6_Error_xx_ILS";}});}